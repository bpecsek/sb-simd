(in-package #:sb-simd-fma)

(define-instruction-set :fma
  (:test (fma-supported-p))
  (:include :avx2)
  (:instructions
   ;; f32
   (f32-fmadd132       #:vfmadd132ss     (f32) (f32 f32 f32) :cost 1 :encoding :fma)
   (f32-fmadd213       #:vfmadd213ss     (f32) (f32 f32 f32) :cost 1 :encoding :fma)
   (f32-fmadd231       #:vfmadd231ss     (f32) (f32 f32 f32) :cost 1 :encoding :fma)
   (f32-fnmadd132      #:vfnmadd132ss    (f32) (f32 f32 f32) :cost 1 :encoding :fma)
   (f32-fnmadd213      #:vfnmadd213ss    (f32) (f32 f32 f32) :cost 1 :encoding :fma)
   (f32-fnmadd231      #:vfnmadd231ss    (f32) (f32 f32 f32) :cost 1 :encoding :fma)
   (f32-fmsub132       #:vfmsub132ss     (f32) (f32 f32 f32) :cost 1 :encoding :fma)
   (f32-fmsub213       #:vfmsub213ss     (f32) (f32 f32 f32) :cost 1 :encoding :fma)
   (f32-fmsub231       #:vfmsub231ss     (f32) (f32 f32 f32) :cost 1 :encoding :fma)
   ;; (f32-fmnsub132      #:vfmnsub132ss    (f32) (f32 f32 f32) :cost 1 :encoding :fma)
   ;; (f32-fmnsub213      #:vfmnsub213ss    (f32) (f32 f32 f32) :cost 1 :encoding :fma)
   ;; (f32-fmnsub231      #:vfmnsub231ss    (f32) (f32 f32 f32) :cost 1 :encoding :fma)
   ;; f64
   (f64-fmadd132       #:vfmadd132sd     (f64) (f64 f64 f64) :cost 1 :encoding :fma)
   (f64-fmadd213       #:vfmadd213sd     (f64) (f64 f64 f64) :cost 1 :encoding :fma)
   (f64-fmadd231       #:vfmadd231sd     (f64) (f64 f64 f64) :cost 1 :encoding :fma)
   (f64-fnmadd132      #:vfnmadd132sd    (f64) (f64 f64 f64) :cost 1 :encoding :fma)
   (f64-fnmadd213      #:vfnmadd213sd    (f64) (f64 f64 f64) :cost 1 :encoding :fma)
   (f64-fnmadd231      #:vfnmadd231sd    (f64) (f64 f64 f64) :cost 1 :encoding :fma)
   (f64-fmsub132       #:vfmsub132sd     (f64) (f64 f64 f64) :cost 1 :encoding :fma)
   (f64-fmsub213       #:vfmsub213sd     (f64) (f64 f64 f64) :cost 1 :encoding :fma)
   (f64-fmsub231       #:vfmsub231sd     (f64) (f64 f64 f64) :cost 1 :encoding :fma)
   ;; (f64-fmnsub132      #:vfmnsub132sd    (f64) (f64 f64 f64) :cost 1 :encoding :fma)
   ;; (f64-fmnsub213      #:vfmnsub213sd    (f64) (f64 f64 f64) :cost 1 :encoding :fma)
   ;; (f64-fmnsub231      #:vfmnsub231sd    (f64) (f64 f64 f64) :cost 1 :encoding :fma)
   ;; f32.4
   (f32.4-fmadd132     #:vfmadd132ps     (f32.4) (f32.4 f32.4 f32.4) :cost 1 :encoding :fma)
   (f32.4-fmadd213     #:vfmadd213ps     (f32.4) (f32.4 f32.4 f32.4) :cost 1 :encoding :fma)
   (f32.4-fmadd231     #:vfmadd231ps     (f32.4) (f32.4 f32.4 f32.4) :cost 1 :encoding :fma)
   (f32.4-fnmadd132    #:vfnmadd132ps    (f32.4) (f32.4 f32.4 f32.4) :cost 1 :encoding :fma)
   (f32.4-fnmadd213    #:vfnmadd213ps    (f32.4) (f32.4 f32.4 f32.4) :cost 1 :encoding :fma)
   (f32.4-fnmadd231    #:vfnmadd231ps    (f32.4) (f32.4 f32.4 f32.4) :cost 1 :encoding :fma)
   (f32.4-fmsub132     #:vfmsub132ps     (f32.4) (f32.4 f32.4 f32.4) :cost 1 :encoding :fma)
   (f32.4-fmsub213     #:vfmsub213ps     (f32.4) (f32.4 f32.4 f32.4) :cost 1 :encoding :fma)
   (f32.4-fmsub231     #:vfmsub231ps     (f32.4) (f32.4 f32.4 f32.4) :cost 1 :encoding :fma)
   ;; (f32.4-fmnsub132    #:vfmnsub132ps    (f32.4) (f32.4 f32.4 f32.4) :cost 1 :encoding :fma)
   ;; (f32.4-fmnsub213    #:vfmnsub213ps    (f32.4) (f32.4 f32.4 f32.4) :cost 1 :encoding :fma)
   ;; (f32.4-fmnsub231    #:vfmnsub231ps    (f32.4) (f32.4 f32.4 f32.4) :cost 1 :encoding :fma)
   (f32.4-fmaddsub132  #:vfmaddsub132ps  (f32.4) (f32.4 f32.4 f32.4) :cost 1 :encoding :fma)
   (f32.4-fmaddsub213  #:vfmaddsub213ps  (f32.4) (f32.4 f32.4 f32.4) :cost 1 :encoding :fma)
   (f32.4-fmaddsub231  #:vfmaddsub231ps  (f32.4) (f32.4 f32.4 f32.4) :cost 1 :encoding :fma)
   (f32.4-fmsubadd132  #:vfmsubadd132ps  (f32.4) (f32.4 f32.4 f32.4) :cost 1 :encoding :fma)
   (f32.4-fmsubadd213  #:vfmsubadd213ps  (f32.4) (f32.4 f32.4 f32.4) :cost 1 :encoding :fma)
   (f32.4-fmsubadd231  #:vfmsubadd231ps  (f32.4) (f32.4 f32.4 f32.4) :cost 1 :encoding :fma)
   ;; f32.8
   (f32.8-fmadd132     #:vfmadd132ps     (f32.8) (f32.8 f32.8 f32.8) :cost 1 :encoding :fma)
   (f32.8-fmadd213     #:vfmadd213ps     (f32.8) (f32.8 f32.8 f32.8) :cost 1 :encoding :fma)
   (f32.8-fmadd231     #:vfmadd231ps     (f32.8) (f32.8 f32.8 f32.8) :cost 1 :encoding :fma)
   (f32.8-fnmadd132    #:vfnmadd132ps    (f32.8) (f32.8 f32.8 f32.8) :cost 1 :encoding :fma)
   (f32.8-fnmadd213    #:vfnmadd213ps    (f32.8) (f32.8 f32.8 f32.8) :cost 1 :encoding :fma)
   (f32.8-fnmadd231    #:vfnmadd231ps    (f32.8) (f32.8 f32.8 f32.8) :cost 1 :encoding :fma)
   (f32.8-fmsub132     #:vfmsub132ps     (f32.8) (f32.8 f32.8 f32.8) :cost 1 :encoding :fma)
   (f32.8-fmsub213     #:vfmsub213ps     (f32.8) (f32.8 f32.8 f32.8) :cost 1 :encoding :fma)
   (f32.8-fmsub231     #:vfmsub231ps     (f32.8) (f32.8 f32.8 f32.8) :cost 1 :encoding :fma)
   ;; (f32.8-fmnsub132    #:vfmnsub132ps    (f32.8) (f32.8 f32.8 f32.8) :cost 1 :encoding :fma)
   ;; (f32.8-fmnsub213    #:vfmnsub213ps    (f32.8) (f32.8 f32.8 f32.8) :cost 1 :encoding :fma)
   ;; (f32.8-fmnsub231    #:vfmnsub231ps    (f32.8) (f32.8 f32.8 f32.8) :cost 1 :encoding :fma)
   (f32.8-fmaddsub132  #:vfmaddsub132ps  (f32.8) (f32.8 f32.8 f32.8) :cost 1 :encoding :fma)
   (f32.8-fmaddsub213  #:vfmaddsub213ps  (f32.8) (f32.8 f32.8 f32.8) :cost 1 :encoding :fma)
   (f32.8-fmaddsub231  #:vfmaddsub231ps  (f32.8) (f32.8 f32.8 f32.8) :cost 1 :encoding :fma)
   (f32.8-fmsubadd132  #:vfmsubadd132ps  (f32.8) (f32.8 f32.8 f32.8) :cost 1 :encoding :fma)
   (f32.8-fmsubadd213  #:vfmsubadd213ps  (f32.8) (f32.8 f32.8 f32.8) :cost 1 :encoding :fma)
   (f32.8-fmsubadd231  #:vfmsubadd231ps  (f32.8) (f32.8 f32.8 f32.8) :cost 1 :encoding :fma)
   ;; f64.2
   (f64.2-fmadd132     #:vfmadd132pd     (f64.2) (f64.2 f64.2 f64.2) :cost 1 :encoding :fma)
   (f64.2-fmadd213     #:vfmadd213pd     (f64.2) (f64.2 f64.2 f64.2) :cost 1 :encoding :fma)
   (f64.2-fmadd231     #:vfmadd231pd     (f64.2) (f64.2 f64.2 f64.2) :cost 1 :encoding :fma)
   (f64.2-fnmadd132    #:vfnmadd132pd    (f64.2) (f64.2 f64.2 f64.2) :cost 1 :encoding :fma)
   (f64.2-fnmadd213    #:vfnmadd213pd    (f64.2) (f64.2 f64.2 f64.2) :cost 1 :encoding :fma)
   (f64.2-fnmadd231    #:vfnmadd231pd    (f64.2) (f64.2 f64.2 f64.2) :cost 1 :encoding :fma)
   (f64.2-fmsub132     #:vfmsub132pd     (f64.2) (f64.2 f64.2 f64.2) :cost 1 :encoding :fma)
   (f64.2-fmsub213     #:vfmsub213pd     (f64.2) (f64.2 f64.2 f64.2) :cost 1 :encoding :fma)
   (f64.2-fmsub231     #:vfmsub231pd     (f64.2) (f64.2 f64.2 f64.2) :cost 1 :encoding :fma)
   ;; (f64.2-fmnsub132    #:vfmnsub132pd    (f64.2) (f64.2 f64.2 f64.2) :cost 1 :encoding :fma)
   ;; (f64.2-fmnsub213    #:vfmnsub213pd    (f64.2) (f64.2 f64.2 f64.2) :cost 1 :encoding :fma)
   ;; (f64.2-fmnsub231    #:vfmnsub231pd    (f64.2) (f64.2 f64.2 f64.2) :cost 1 :encoding :fma)
   (f64.2-fmaddsub132  #:vfmaddsub132pd  (f64.2) (f64.2 f64.2 f64.2) :cost 1 :encoding :fma)
   (f64.2-fmaddsub213  #:vfmaddsub213pd  (f64.2) (f64.2 f64.2 f64.2) :cost 1 :encoding :fma)
   (f64.2-fmaddsub231  #:vfmaddsub231pd  (f64.2) (f64.2 f64.2 f64.2) :cost 1 :encoding :fma)
   (f64.2-fmsubadd132  #:vfmsubadd132pd  (f64.2) (f64.2 f64.2 f64.2) :cost 1 :encoding :fma)
   (f64.2-fmsubadd213  #:vfmsubadd213pd  (f64.2) (f64.2 f64.2 f64.2) :cost 1 :encoding :fma)
   (f64.2-fmsubadd231  #:vfmsubadd231pd  (f64.2) (f64.2 f64.2 f64.2) :cost 1 :encoding :fma)
   ;; f64.4
   (f64.4-fmadd132     #:vfmadd132pd     (f64.4) (f64.4 f64.4 f64.4) :cost 1 :encoding :fma)
   (f64.4-fmadd213     #:vfmadd213pd     (f64.4) (f64.4 f64.4 f64.4) :cost 1 :encoding :fma)
   (f64.4-fmadd231     #:vfmadd231pd     (f64.4) (f64.4 f64.4 f64.4) :cost 1 :encoding :fma)
   (f64.4-fnmadd132    #:vfnmadd132pd    (f64.4) (f64.4 f64.4 f64.4) :cost 1 :encoding :fma)
   (f64.4-fnmadd213    #:vfnmadd213pd    (f64.4) (f64.4 f64.4 f64.4) :cost 1 :encoding :fma)
   (f64.4-fnmadd231    #:vfnmadd231pd    (f64.4) (f64.4 f64.4 f64.4) :cost 1 :encoding :fma)
   (f64.4-fmsub132     #:vfmsub132pd     (f64.4) (f64.4 f64.4 f64.4) :cost 1 :encoding :fma)
   (f64.4-fmsub213     #:vfmsub213pd     (f64.4) (f64.4 f64.4 f64.4) :cost 1 :encoding :fma)
   (f64.4-fmsub231     #:vfmsub231pd     (f64.4) (f64.4 f64.4 f64.4) :cost 1 :encoding :fma)
   ;; (f64.4-fmnsub132    #:vfmnsub132pd    (f64.4) (f64.4 f64.4 f64.4) :cost 1 :encoding :fma)
   ;; (f64.4-fmnsub213    #:vfmnsub213pd    (f64.4) (f64.4 f64.4 f64.4) :cost 1 :encoding :fma)
   ;; (f64.4-fmnsub231    #:vfmnsub231pd    (f64.4) (f64.4 f64.4 f64.4) :cost 1 :encoding :fma)
   (f64.4-fmaddsub132  #:vfmaddsub132pd  (f64.4) (f64.4 f64.4 f64.4) :cost 1 :encoding :fma)
   (f64.4-fmaddsub213  #:vfmaddsub213pd  (f64.4) (f64.4 f64.4 f64.4) :cost 1 :encoding :fma)
   (f64.4-fmaddsub231  #:vfmaddsub231pd  (f64.4) (f64.4 f64.4 f64.4) :cost 1 :encoding :fma)
   (f64.4-fmsubadd132  #:vfmsubadd132pd  (f64.4) (f64.4 f64.4 f64.4) :cost 1 :encoding :fma)
   (f64.4-fmsubadd213  #:vfmsubadd213pd  (f64.4) (f64.4 f64.4 f64.4) :cost 1 :encoding :fma)
   (f64.4-fmsubadd231  #:vfmsubadd231pd  (f64.4) (f64.4 f64.4 f64.4) :cost 1 :encoding :fma)))
